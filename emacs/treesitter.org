* Treesitter

** Install language grammar libraries

Before you can have ~xxx-ts-mode~ (~xxx~ is the language name), you need to walk through the following steps:


*** 1. Set the `treesit-language-source-alist` with all langauges you needed:

#+begin_src emacs-lisp
  ;;
  ;; Configuration for downloading and installing tree-sitter language grammars.
  ;; If you don't set this, you can't run the batch command to install all of
  ;; them in one-shot (as it will ask you the confirm git URL).
  ;;
  ;; If you can't find the language gammar in 'https://github.com/tree-sitter/tree-sitter-xxx'
  ;; then take a look at the Neovim treesitter README, it includes some third-party
  ;; implementations:
  ;;
  ;; '~/.local/share/nvim/site/pack/packer/start/nvim-treesitter/README.md'
  ;;
  (setq treesit-language-source-alist
    '((c "https://github.com/tree-sitter/tree-sitter-c")
      (cpp "https://github.com/tree-sitter/tree-sitter-cpp")
      (zig "https://github.com/maxxnino/tree-sitter-zig")
      (rust "https://github.com/tree-sitter/tree-sitter-rust")
      (bash "https://github.com/tree-sitter/tree-sitter-bash")
      (cmake "https://github.com/uyha/tree-sitter-cmake")
      (css "https://github.com/tree-sitter/tree-sitter-css")
      (elisp "https://github.com/Wilfred/tree-sitter-elisp")
      (go "https://github.com/tree-sitter/tree-sitter-go")
      (html "https://github.com/tree-sitter/tree-sitter-html")
      (javascript "https://github.com/tree-sitter/tree-sitter-javascript" "master" "src")
      (json "https://github.com/tree-sitter/tree-sitter-json")
      (make "https://github.com/alemuller/tree-sitter-make")
      (markdown "https://github.com/ikatyang/tree-sitter-markdown")
      (python "https://github.com/tree-sitter/tree-sitter-python")
      (toml "https://github.com/tree-sitter/tree-sitter-toml")
      (tsx "https://github.com/tree-sitter/tree-sitter-typescript" "master" "tsx/src")
      (typescript "https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src")
      (yaml "https://github.com/ikatyang/tree-sitter-yaml")
      (fish "https://github.com/ram02z/tree-sitter-fish")
     )
  )


  ;;
  ;; Change the default major mode
  ;;
  (add-to-list 'auto-mode-alist '("\\.toml\\'" . toml-ts-mode))
  (add-to-list 'auto-mode-alist '("\\.rs\\'" . rust-ts-mode))
  (add-to-list 'auto-mode-alist '("\\.c\\'" . c-ts-mode))
  (add-to-list 'auto-mode-alist '("\\.h\\'" . c-or-c++-ts-mode))
  (add-to-list 'auto-mode-alist '("CMakeLists.txt" . cmake-ts-mode))
  (add-to-list 'auto-mode-alist '("\\.md\\'" . markdown-mode))
  (add-to-list 'auto-mode-alist '("\\.fish\\'" . fish-mode))
  (add-to-list 'auto-mode-alist '("lfrc" . bash-mode))
  (add-to-list 'auto-mode-alist '("bspwmrc" . bash-mode))
  (add-to-list 'auto-mode-alist '("\\.clang-format\\'" . bash-mode))
  (add-to-list 'auto-mode-alist '("\\.json\\'" . json-ts-mode))


  ;;
  ;; remap the non-treesitter mode to treesitter mode
  ;;
  (setq major-mode-remap-alist
   '((c-mode . c-ts-mode)
     (c++-mode . c++-ts-mode)
     (bash-mode . bash-ts-mode)
     (sh-mode . bash-ts-mode)
     (cmake-mode . cmake-ts-mode)
     (css-mode . css-ts-mode)
     (elisp-mode . elisp-ts-mode)
     (go-mode . go-ts-mode)
     (html-mode . html-ts-mode)
     (js-mode . js-ts-mode)
     (make-mode . make-ts-mode)
     (json-mode . json-ts-mode)
     (js-json-mode . json-ts-mode)
     (python-mode . python-ts-mode)
     (tsx-mode . tsx-ts-mode)
     (typescript-mode . typescript-ts-mode)
     (yaml-mode . yaml-ts-mode)
    )
  )
#+end_src


*** 2. Install all of them

You can either ~M-x~ then ~treesit-install-language-grammar~ to install one-by-one, or you can run the following batch command to install all of them in one-shot:

#+begin_src emacs-lisp
  ;; (mapc #'treesit-install-language-grammar (mapcar #'car treesit-language-source-alist))
#+end_src

=Uncomment the above command to install, and make sure you re-comment the above command to avoid run it every time you open Emacs!!!=
=Uncomment the above command to install, and make sure you re-comment the above command to avoid run it every time you open Emacs!!!=
=Uncomment the above command to install, and make sure you re-comment the above command to avoid run it every time you open Emacs!!!=


They should be installed to your =~/.config/emacs/tree-sitter= folder like this:

#+begin_src bash
  ls -lht tree-sitter/

  # total 9.5M
  # -rwxr-xr-x 1 wison wison 230K Aug 17 18:50 libtree-sitter-yaml.so*
  # -rwxr-xr-x 1 wison wison 1.2M Aug 17 18:50 libtree-sitter-typescript.so*
  # -rwxr-xr-x 1 wison wison 1.2M Aug 17 18:50 libtree-sitter-tsx.so*
  # -rwxr-xr-x 1 wison wison  40K Aug 17 18:50 libtree-sitter-toml.so*
  # -rwxr-xr-x 1 wison wison 529K Aug 17 18:50 libtree-sitter-python.so*
  # -rwxr-xr-x 1 wison wison 825K Aug 17 18:50 libtree-sitter-markdown.so*
  # -rwxr-xr-x 1 wison wison 168K Aug 17 18:50 libtree-sitter-make.so*
  # -rwxr-xr-x 1 wison wison  16K Aug 17 18:49 libtree-sitter-json.so*
  # -rwxr-xr-x 1 wison wison 353K Aug 17 18:49 libtree-sitter-javascript.so*
  # -rwxr-xr-x 1 wison wison  38K Aug 17 18:49 libtree-sitter-html.so*
  # -rwxr-xr-x 1 wison wison 300K Aug 17 18:49 libtree-sitter-go.so*
  # -rwxr-xr-x 1 wison wison  60K Aug 17 18:49 libtree-sitter-elisp.so*
  # -rwxr-xr-x 1 wison wison  76K Aug 17 18:49 libtree-sitter-css.so*
  # -rwxr-xr-x 1 wison wison 100K Aug 17 18:49 libtree-sitter-cmake.so*
  # -rwxr-xr-x 1 wison wison 638K Aug 17 18:49 libtree-sitter-bash.so*
  # -rwxr-xr-x 1 wison wison 3.2M Aug 17 18:49 libtree-sitter-cpp.so*
  # -rwxr-xr-x 1 wison wison 668K Aug 17 18:49 libtree-sitter-c.so*
  # -rwxr-xr-x 1 wison wison 812K Aug 17 19:10 libtree-sitter-zig.so*
  # -rwxr-xr-x 1 wison wison 829K Aug 17 19:32 libtree-sitter-rust.so*
#+end_src


You can check each of them to see whether has been install successfully or not:

#+begin_src emacs-lisp
  ;;
  ;; Return 't' means install successfully
  ;;
  ;; (treesit-language-available-p 'c)
  ;; (treesit-language-available-p 'cpp)
  ;; (treesit-language-available-p 'zig)
  ;; (treesit-language-available-p 'rust)
  ;; (treesit-language-available-p 'bash)
  ;; (treesit-language-available-p 'cmake)
  ;; (treesit-language-available-p 'css)
  ;; (treesit-language-available-p 'elisp)
  ;; (treesit-language-available-p 'go)
  ;; (treesit-language-available-p 'html)
  ;; (treesit-language-available-p 'javascript)
  ;; (treesit-language-available-p 'json)
  ;; (treesit-language-available-p 'make)
  ;; (treesit-language-available-p 'markdown)
  ;; (treesit-language-available-p 'python)
  ;; (treesit-language-available-p 'toml)
  ;; (treesit-language-available-p 'tsx)
  ;; (treesit-language-available-p 'typescript)
  ;; (treesit-language-available-p 'yaml)
  ;; (treesit-language-available-p 'fish)
#+end_src
